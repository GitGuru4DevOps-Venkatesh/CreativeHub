pipeline {
  agent any

  stages {
    stage('Checkout') {
      steps {
        // Checkout the code from the Git repository (using scm for brevity)
        checkout scm
      }
    }

    stage('Build') {
      steps {
        // Build the Docker image (assuming Dockerfile is present in the root directory)
        script {
          docker.build(imageName: 'service-website') // Using imageName for clarity
        }
      }
    }

    stage('Deploy') {
      steps {
        // Check if the container is already running
        script {
          def containerId = sh(script: 'docker ps -q --filter "name=service-website"', returnStdout: true).trim()
          if (containerId) {
            // Stop and remove the existing container
            sh "docker stop $containerId"
            sh "docker rm $containerId"
          }
        }

        // Run the new container with port mapping and volume mounting
        sh 'docker run -d -p 80:80 -v $PWD:/usr/share/nginx/html service-website'
      }
    }
  }
}
